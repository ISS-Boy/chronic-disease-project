<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.smartloli.kafka.eagle.web.dao.OffLineLearningDao">

    <!-- 清空疾病表 -->
    <update id="truncateDisease">
        truncate table ${tableName}
    </update>

    <!-- 插入所有疾病 -->
    <insert id="insertAllDisease" parameterType="java.util.List">
        INSERT INTO ke_disease (diseaseName) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item})
        </foreach>
    </insert>

    <insert id="insertConfigure" parameterType="org.smartloli.kafka.eagle.web.pojo.LearningConfigure">
        INSERT INTO ke_configure (
            configureId,
            configureName,
            age,
            gender,
            disease,
            metric,
            dateBegin,
            dateEnd,
            slidingWindowSize,
            paaSize,
            alphabetSize,
            analysisWindowStartSize,
            frequencyThreshold,
            rThreshold,
            k
        ) VALUE (
            #{configureId},
            #{configureName},
            #{age},
            #{gender},
            #{disease},
            #{metric},
            #{dateBegin},
            #{dateEnd},
            #{slidingWindowSize},
            #{paaSize},
            #{alphabetSize},
            #{analysisWindowStartSize},
            #{frequencyThreshold},
            #{rThreshold},
            #{k}
        )
    </insert>

    <update id="updateIsDone" parameterType="java.lang.String">
        UPDATE ke_configure SET isDone = '1'
        WHERE id = #{id}
    </update>

    <insert id="insertAllSymbolicPattern" parameterType="java.util.List">
        INSERT INTO ke_symbolic_pattern (id,configureId,alias,order,length) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.id},#{item.configureId},#{item.alias},#{item.order},#{item.length})
        </foreach>
    </insert>

    <insert id="insertAllPatternDetail" parameterType="java.util.List">
        INSERT INTO ke_pattern_detail (id,symbolicPatternId,measureName,measureValue) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.id},#{item.symbolicPatternId},#{item.measureName},#{item.measureValue})
        </foreach>
    </insert>

    <select id="getAllDisease" resultType="org.smartloli.kafka.eagle.web.pojo.DiseaseDB">
        SELECT * FROM ke_disease WHERE 1=1
    </select>
</mapper>